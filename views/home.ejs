<!DOCTYPE html>
<html>
<head>
	<title>home</title>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"
			  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
			  crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.js"></script>
</head>
<body onLoad="start();">
	BENVENUTO NELLA HOME
	<form action="http://localhost:3000/logout" method="GET">
		<button>Log-Out</button>
	</form>
	<form action="http://localhost:3000/logoutFromFacebook" method="GET">
		<button>Log-Out-Facebook</button>
	</form>
	<form method="POST" action="http://localhost:3000/abbandona?_method=PUT">
		<input type="text" name="evento" placeholder="Evento da abbandonare">
		<input type="text" name="squadra" placeholder="Squadra da abbandonare">
		<input type="submit" value="Abbandona" >
	</form>
	<button id="me">mostra eventi a cui partecipo</button>
	<div id="mostraeventi"></div>
	<form method="" action="">
		<input type="text" id = "giorno_s" name="giorno" placeholder="Giorno">
		<input type="text" id = "mese_s" name="mese" placeholder="Mese">
		<input type="text" id = "anno_s" name="anno" placeholder="Anno">
		<input type="text" id = "indirizzo_s" name="indirizzo" placeholder="Inserisci Indirizzo">
	</form>
	<button id = "search">mostra eventi con le caratteristiche specificate</button>
	<div id="s"></div>
	<form action="" method="">
	<table border = "1">
	<td align="right">Luogo:
	<td><input id="ccs_indirizzo" type="text" name="indirizzo" size="40" maxlength="40" placeholder="Inserisci Indirizzo"><tr>
</table>
</form>
<button id="ccs">cerca centri sportivi</button>
<div id="selezionaluogo"></div>
	<form action="http://localhost:3000/MiAggiungo?_method=PUT" method="POST">
	<table border = "1">
	<td align="right">Nome Evento:
	<td><input type="text" name="evento" size="20" maxlength="20" placeholder="Inserisci Nome Evento">
	<label><input type="radio" name="Squadra" value="A"/>SquadraA</label>
	<label><input type="radio" name="Squadra" value="B"/>SquadraB</label>
	<input type="submit" value="Aggiungimi ad evento"></td>
</td>
</table>
</form>
	<form action="http://localhost:3000/feedback?_method=PUT" method="POST">
	<table border = "1">
	<td align="right">Evento Giocato:
	<td><input type="text" name="eventoterminato" size="30" maxlenght="30" placeholder="Nome Evento Giocato">
	<td align="right">Nome Utente:
	<td><input type="text" name="emailrecensito" size="30" maxlenght="30" placeholder="Email Utente Da Recensire">
	<td><input type="text" name="valore" size="15" maxlength="1" placeholder="Inserisci Valore 0-9">
	<input type="submit" value="Rilascia feedback"></td>
</td>
</table>
</form>
	<form action="http://localhost:3000/CreaEvento" method="POST">
	<table border = "1">
	<td align="right">Nome:
	<td><input type="text" name="nomeevento" size="30" maxlenght="30" placeholder="Nome Evento">
	<td align="right">Anno:
	<td><input type="text" name="anno" size="30" maxlenght="30" placeholder="Inserire anno">
	<td align="right">Mese:
	<td><input type="text" name="mese" size="30" maxlenght="30" placeholder="Inserire mese">
	<td align="right">Giorno:
	<td><input type="text" name="giorno" size="30" maxlenght="30" placeholder="Inserire giorno">
	<td align="right">Ora:
	<td><input type="text" name="ora" placeholder="Inserire Orario">
	<td align="right">indirizzo:
	<input type="text" name="indirizzo">
	<input type="submit" value="Crea Evento"></td>
</td>
</table>
</form>
<a href="http://localhost:3000/connect/google">connetti a google</a>

<form action="http://localhost:3000/addc" method="POST">
	<input type="text" name="evento">
	<input type="submit" value="aggiungi al calendario">
</form>
<form action="http://localhost:3000/cancellaEvento" method="POST">
	<input type="text" name="eventoc">
	<input type="submit" value="elimina stefano">
</form>
	
<script type="text/javascript">
	function start(){
		$.get("http://localhost:3000/chisono",function(data,status){
			console.log(status);
			if(status == "success"){
				
				console.log(data);
				var ws=new WebSocket('ws://172.17.0.2:15674/ws');
        		var client = Stomp.over(ws);
        		var on_connect = function() {
        		console.log('connected');
        		};
        		var on_error =  function() {
        		console.log('error');
      		};
      		var on_connect = function(x) {
      		
          	id = client.subscribe("/amq/queue/"+data, function(d) {
             alert(d.body);
          });
      };
     
       client.connect('guest', 'guest', on_connect, on_error, '/');
				
				};
			});
		};
        
	
	$("#ccs").click(function(){
		var ind = $("#ccs_indirizzo").val();
		console.log(ind);
		$.get("http://localhost:3000/selezionaluogo?indirizzo="+ind,function(data,status){
			console.log(status);
			if(status == "success"){
				var d = JSON.parse(data);
				console.log(d);
				$("#sl").remove();
				$("#selezionaluogo").append("<ul id=\"sl\"></ul>")
				for (var i = 0; i < d.results.length; i++) {
					$("#sl").append("<li>"+d.results[i].name+"</li>");
				}
			}
		})
	})

	$("#me").click(function(){
		$.get("http://localhost:3000/eventi",function(data,status){
			console.log(status);
			if(status == "success"){
				var d = JSON.parse(data);
				console.log(d);
				$("#mose").remove();
				$("#mostraeventi").append("<ul id=\"mose\"></ul>")
				for (var i = 0; i < d.ev.length; i++) {
					$("#mose").append("<li class=\"cl\">"+d.ev[i]._id+"</li>");
				}
				$(".cl").click(function(){
                    var m=$(this);
    				$.get("http://localhost:3000/dammievento?ev="+$(this).html(),function(data,status){
					console.log(status);
					if(status == "success"){
					var d = JSON.parse(data);
					console.log(d);
					var squadraA="";
					var squadraB="";
					for (var i = 0; i < d.squadra_A.length; i++) {
					squadraA+=d.squadra_A[i].email +"\n";
					};
					console.log(squadraA);
					for (var i = 0; i < d.squadra_B.length; i++) {
					squadraB+=d.squadra_B[i].email+="\n";
					};
					console.log(squadraB);
				    m.append("<p><table><tr><td>Nome: <td>"+d._id+"</tr><tr><td> Data: <td>"+d.data+"</tr><tr><td> Coordinate: <td>"+d.geo.coordinates[0]+" // "+d.geo.coordinates[1]+ "</tr><tr><td> Squadra A: <td>"+squadraA+"</tr><tr><td> Squadra B: <td>"+squadraB+"</tr></table></p>");
			}
		})
	})
			}
		})
	})

	$("#search").click(function(){
		var giorno = $("#giorno_s").val();
		var mese = $("#mese_s").val();
		var anno = $("#anno_s").val();
		var indirizzo = $("#indirizzo_s").val();
		$.get("http://localhost:3000/search?giorno="+giorno+"&mese="+mese+"&anno="+anno+"&indirizzo="+indirizzo,function(data,status){
			console.log(status);
			if(status == "success"){
				var d = JSON.parse(data);
				console.log(d);
				$("#se").remove();
				$("#s").append("<ul id=\"se\"></ul>")
				for (var i = 0; i < d.length; i++) {
					$("#se").append("<li>"+d[i]._id+"</li>");
				}
			}
		})
	})
</script>
</body>
</html>